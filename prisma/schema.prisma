generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(uuid())
  username     String   @unique
  passwordHash String   @map("password_hash")
  createdAt    DateTime @default(now()) @map("created_at")

  @@map("users")
}

model TeamMember {
  id        String   @id @default(uuid())
  accessId  String   @unique @map("access_id")
  name      String
  phone     String?
  email     String?
  position  String?
  createdAt DateTime @default(now()) @map("created_at")

  drones Drone[] @relation("AccountableManager")

  @@map("team_members")
}

model Subcontractor {
  id            String   @id @default(uuid())
  companyName   String   @map("company_name")
  type          String   // 'Design' or 'Manufacturing'
  contactPerson String?  @map("contact_person")
  contactEmail  String?  @map("contact_email")
  contactPhone  String?  @map("contact_phone")
  agreementDate String?  @map("agreement_date")
  createdAt     DateTime @default(now()) @map("created_at")

  @@map("subcontractors")
}

model Drone {
  id                   String   @id @default(uuid())
  modelName            String   @map("model_name")
  image                String?  @db.Text
  accountableManagerId String?  @map("accountable_manager_id")
  webPortalLink        String?  @map("web_portal_link")
  createdAt            DateTime @default(now()) @map("created_at")

  accountableManager TeamMember?   @relation("AccountableManager", fields: [accountableManagerId], references: [id])
  uploads            DroneUpload[]
  manufacturedUnits  ManufacturedUnit[]
  recurringData      Json?            @map("recurring_data")

  @@map("drones")
}

model ManufacturedUnit {
  id           String   @id @default(uuid())
  droneId      String   @map("drone_id")
  serialNumber String   @map("serial_number")
  uin          String   @map("uin")
  createdAt    DateTime @default(now()) @map("created_at")

  drone Drone @relation(fields: [droneId], references: [id], onDelete: Cascade)

  @@map("manufactured_units")
}

model DroneUpload {
  id         String   @id @default(uuid())
  droneId    String   @map("drone_id")
  uploadType String   @map("upload_type") // training_manual, infrastructure_manufacturing, etc.
  fileData   String   @db.Text @map("file_data")
  label      String?  // For 'others' category
  createdAt  DateTime @default(now()) @map("created_at")

  drone Drone @relation(fields: [droneId], references: [id], onDelete: Cascade)

  @@map("drone_uploads")
}

model Battery {
  id             String   @id @default(uuid())
  model          String
  ratedCapacity  String   @map("rated_capacity")
  batteryNumberA String   @map("battery_number_a")
  batteryNumberB String   @map("battery_number_b")
  createdAt      DateTime @default(now()) @map("created_at")

  @@map("batteries")
}

model Order {
  id                          String   @id @default(uuid())
  
  // 1. Core Order & Financial Information
  contractNumber              String   @unique @map("contract_number")
  clientName                  String   @map("client_name")
  clientSegment               String   @map("client_segment")
  orderDate                   DateTime @map("order_date")
  estimatedCompletionDate     DateTime? @map("estimated_completion_date")
  contractValue               Float    @map("contract_value")
  currency                    String   @default("INR")
  revenueRecognitionStatus    String   @default("Pending") @map("revenue_recognition_status")
  
  // 2. Technical & Configuration Details
  droneModel                  String   @map("drone_model")
  droneType                   String   @map("drone_type")
  weightClass                 String   @map("weight_class")
  payloadConfiguration        String?  @map("payload_configuration")
  flightEnduranceRequirements String?  @map("flight_endurance_requirements")
  softwareAiTier              String?  @map("software_ai_tier")
  
  // 3. Regulatory & Compliance Tracking
  dgcaFaaCertificationStatus  String   @default("Pending") @map("dgca_faa_certification_status")
  uin                         String?
  exportLicenseStatus         String?  @map("export_license_status")
  geofencingRequirements      String?  @map("geofencing_requirements")
  
  // 4. Operational & Delivery Status
  bomReadiness                String   @default("Not Ready") @map("bom_readiness")
  manufacturingStage          String   @default("In Design") @map("manufacturing_stage")
  calibrationTestLogs         String?  @db.Text @map("calibration_test_logs")
  afterSalesAmc               String?  @map("after_sales_amc")
  
  createdAt                   DateTime @default(now()) @map("created_at")
  updatedAt                   DateTime @updatedAt @map("updated_at")

  @@map("orders")
}
